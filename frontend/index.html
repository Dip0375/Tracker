<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Tracking Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <span>IP Tracker</span>
            </div>
            <nav class="nav-menu">
                <a href="#dashboard" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </a>
                <a href="#ips" class="nav-item" data-page="ips">
                    <i class="fas fa-globe"></i> IP Addresses
                </a>
                <a href="#uris" class="nav-item" data-page="uris">
                    <i class="fas fa-link"></i> URIs
                </a>
                <a href="#files" class="nav-item" data-page="files">
                    <i class="fas fa-file"></i> Malicious Files
                </a>
                <a href="#history" class="nav-item" data-page="history">
                    <i class="fas fa-history"></i> Action History
                </a>
                <a href="#admin" class="nav-item" data-page="admin" id="admin-nav" style="display: none;">
                    <i class="fas fa-cog"></i> Admin Console
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="global-search" placeholder="Search IPs, URIs, files...">
                    </div>
                    <div class="user-menu">
                        <div class="user-profile" id="user-profile">
                            <img src="https://via.placeholder.com/40" alt="User" class="avatar" id="user-avatar">
                            <span id="user-name">SOC Analyst</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="#" id="edit-profile-btn">
                                <i class="fas fa-user-edit"></i> Edit Profile
                            </a>
                            <a href="#" id="admin-console-btn">
                                <i class="fas fa-cog"></i> Admin Console
                            </a>
                            <a href="#" id="admin-login-btn">
                                <i class="fas fa-key"></i> Login as Admin
                            </a>
                            <hr>
                            <a href="#" id="logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-container">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <h2>Dashboard Analytics</h2>
                        <div class="timeframe-selector">
                            <div class="time-picker-container">
                                <button class="time-picker-btn" id="time-picker-btn">
                                    <i class="fas fa-clock"></i>
                                    <span id="selected-time">Relative: Last 1 hour</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="time-picker-dropdown" id="time-picker-dropdown">
                                    <div class="time-tabs">
                                        <button class="time-tab active" data-tab="relative">Relative</button>
                                        <button class="time-tab" data-tab="absolute">Absolute</button>
                                    </div>
                                    
                                    <div class="relative-time-content" id="relative-content">
                                        <div class="time-section">
                                            <h4>Minutes</h4>
                                            <div class="time-options">
                                                <button class="time-option" data-timeframe="5m">5 minutes</button>
                                                <button class="time-option" data-timeframe="15m">15 minutes</button>
                                                <button class="time-option" data-timeframe="30m">30 minutes</button>
                                            </div>
                                        </div>
                                        <div class="time-section">
                                            <h4>Hours</h4>
                                            <div class="time-options">
                                                <button class="time-option active" data-timeframe="1h">1 hour</button>
                                                <button class="time-option" data-timeframe="3h">3 hours</button>
                                                <button class="time-option" data-timeframe="6h">6 hours</button>
                                                <button class="time-option" data-timeframe="12h">12 hours</button>
                                            </div>
                                        </div>
                                        <div class="time-section">
                                            <h4>Days</h4>
                                            <div class="time-options">
                                                <button class="time-option" data-timeframe="1d">1 day</button>
                                                <button class="time-option" data-timeframe="3d">3 days</button>
                                                <button class="time-option" data-timeframe="1w">1 week</button>
                                            </div>
                                        </div>
                                        <div class="time-section">
                                            <h4>Months</h4>
                                            <div class="time-options">
                                                <button class="time-option" data-timeframe="1M">1 month</button>
                                                <button class="time-option" data-timeframe="3M">3 months</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="absolute-time-content" id="absolute-content" style="display: none;">
                                        <div class="absolute-inputs">
                                            <div class="input-group">
                                                <label>Start Date & Time</label>
                                                <input type="datetime-local" id="absolute-start-time">
                                            </div>
                                            <div class="input-group">
                                                <label>End Date & Time</label>
                                                <input type="datetime-local" id="absolute-end-time">
                                            </div>
                                            <button class="btn btn-primary" id="apply-absolute-time">Apply</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>Total IPs</h3>
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="stat-value" id="total-ips">0</div>
                            <div class="stat-footer">
                                <span class="blocked">Blocked: <strong id="blocked-ips">0</strong></span>
                                <span class="whitelisted">Whitelisted: <strong id="whitelisted-ips">0</strong></span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>Total URIs</h3>
                                <i class="fas fa-link"></i>
                            </div>
                            <div class="stat-value" id="total-uris">0</div>
                            <div class="stat-footer">
                                <span class="blocked">Blocked: <strong id="blocked-uris">0</strong></span>
                                <span class="whitelisted">Whitelisted: <strong id="whitelisted-uris">0</strong></span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>Malicious Files</h3>
                                <i class="fas fa-file"></i>
                            </div>
                            <div class="stat-value" id="total-files">0</div>
                            <div class="stat-footer">
                                <span class="blocked">Quarantined: <strong id="quarantined-files">0</strong></span>
                                <span class="whitelisted">Detected: <strong id="detected-files">0</strong></span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>Severity Dashboard</h3>
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="stat-footer" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                                <span style="color: #dc2626;">Critical: <strong id="critical-count">0</strong></span>
                                <span style="color: #ea580c;">High: <strong id="high-count">0</strong></span>
                                <span style="color: #ca8a04;">Medium: <strong id="medium-count">0</strong></span>
                                <span style="color: #16a34a;">Low: <strong id="low-count">0</strong></span>
                            </div>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>IP Distribution by Severity</h3>
                            <canvas id="severity-chart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>IP Distribution by Source</h3>
                            <canvas id="source-chart"></canvas>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>Threat Types</h3>
                            <canvas id="threat-chart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Malware Types</h3>
                            <canvas id="malware-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- IP Addresses Page -->
                <div id="ips-page" class="page">
                    <div class="page-header">
                        <h2>IP Address Management</h2>
                        <button id="add-ip-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add IP
                        </button>
                    </div>

                    <!-- IP Form Modal -->
                    <div id="ip-form-modal" class="modal">
                        <div class="modal-content large">
                            <span class="close">&times;</span>
                            <h3>Add/Edit IP Address</h3>
                            <form id="ip-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>IP Address *</label>
                                        <input type="text" id="ip-address" placeholder="192.168.1.1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Status *</label>
                                        <select id="ip-status" required>
                                            <option value="">Select Status</option>
                                            <option value="BLOCKED">Blocked</option>
                                            <option value="WHITELIST">Whitelist</option>
                                            <option value="SUSPICIOUS">Suspicious</option>
                                            <option value="MONITORING">Monitoring</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Source Device *</label>
                                        <select id="ip-source" required>
                                            <option value="">Select Source Device</option>
                                            <option value="AWS_WAF">AWS WAF</option>
                                            <option value="BARRACUDA_WAAS">Barracuda WAAS</option>
                                            <option value="TRENDMICRO">TrendMicro</option>
                                            <option value="PALOALTO_FIREWALL">Palo Alto Next-Gen Firewall</option>
                                            <option value="KASPERSKY">Kaspersky</option>
                                            <option value="CORTEX_XDR">Cortex XDR</option>
                                            <option value="FORTINET">FortiGate</option>
                                            <option value="CHECKPOINT">Check Point</option>
                                            <option value="SOPHOS">Sophos</option>
                                            <option value="SOC_ANALYST">SOC Analyst</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Severity</label>
                                        <select id="ip-severity">
                                            <option value="MEDIUM">Medium</option>
                                            <option value="LOW">Low</option>
                                            <option value="HIGH">High</option>
                                            <option value="CRITICAL">Critical</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Reason *</label>
                                        <textarea id="ip-reason" placeholder="Reason for blocking/flagging" required></textarea>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Detection Date & Time *</label>
                                        <input type="datetime-local" id="ip-detection-time" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Location</label>
                                        <input type="text" id="ip-location" placeholder="Geographic location">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Action Taken By</label>
                                        <input type="text" id="ip-action-by" placeholder="Your name/system">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Notes</label>
                                    <textarea id="ip-notes" placeholder="Additional notes"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">Save IP</button>
                            </form>
                        </div>
                    </div>

                    <!-- IP Search & Filter -->
                    <div class="filter-section">
                        <input type="text" id="ip-search" placeholder="Search IP address...">
                        <select id="ip-status-filter">
                            <option value="">All Status</option>
                            <option value="BLOCKED">Blocked</option>
                            <option value="WHITELIST">Whitelist</option>
                            <option value="SUSPICIOUS">Suspicious</option>
                            <option value="MONITORING">Monitoring</option>
                        </select>
                    </div>

                    <!-- IP Table -->
                    <div class="table-container">
                        <table id="ip-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>Status</th>
                                    <th>Severity</th>
                                    <th>Source</th>
                                    <th>Reason</th>
                                    <th>Date Added</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ip-tbody">
                            </tbody>
                        </table>
                    </div>

                    <div id="ip-pagination" class="pagination"></div>
                </div>

                <!-- URIs Page -->
                <div id="uris-page" class="page">
                    <div class="page-header">
                        <h2>URI Management</h2>
                        <button id="add-uri-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add URI
                        </button>
                    </div>

                    <!-- URI Form Modal -->
                    <div id="uri-form-modal" class="modal">
                        <div class="modal-content large">
                            <span class="close">&times;</span>
                            <h3>Add/Edit URI</h3>
                            <form id="uri-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>URI *</label>
                                        <input type="text" id="uri-address" placeholder="https://example.com/malicious" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Status *</label>
                                        <select id="uri-status" required>
                                            <option value="">Select Status</option>
                                            <option value="BLOCKED">Blocked</option>
                                            <option value="WHITELIST">Whitelist</option>
                                            <option value="SUSPICIOUS">Suspicious</option>
                                            <option value="MONITORING">Monitoring</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Source Device *</label>
                                        <select id="uri-source" required>
                                            <option value="">Select Source Device</option>
                                            <option value="AWS_WAF">AWS WAF</option>
                                            <option value="BARRACUDA_WAAS">Barracuda WAAS</option>
                                            <option value="TRENDMICRO">TrendMicro</option>
                                            <option value="PALOALTO_FIREWALL">Palo Alto Next-Gen Firewall</option>
                                            <option value="KASPERSKY">Kaspersky</option>
                                            <option value="CORTEX_XDR">Cortex XDR</option>
                                            <option value="FORTINET">FortiGate</option>
                                            <option value="CHECKPOINT">Check Point</option>
                                            <option value="SOPHOS">Sophos</option>
                                            <option value="SOC_ANALYST">SOC Analyst</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Threat Type</label>
                                        <select id="uri-threat-type">
                                            <option value="UNKNOWN">Unknown</option>
                                            <option value="MALWARE">Malware</option>
                                            <option value="PHISHING">Phishing</option>
                                            <option value="C2">C2 Command & Control</option>
                                            <option value="EXFILTRATION">Data Exfiltration</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Severity</label>
                                        <select id="uri-severity">
                                            <option value="MEDIUM">Medium</option>
                                            <option value="LOW">Low</option>
                                            <option value="HIGH">High</option>
                                            <option value="CRITICAL">Critical</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Reason *</label>
                                    <textarea id="uri-reason" placeholder="Reason for blocking/flagging" required></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Detection Date & Time *</label>
                                        <input type="datetime-local" id="uri-detection-time" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Action Taken By</label>
                                        <input type="text" id="uri-action-by" placeholder="Your name/system">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Associated IPs</label>
                                    <input type="text" id="uri-associated-ips" placeholder="Comma-separated IPs">
                                </div>

                                <div class="form-group">
                                    <label>Notes</label>
                                    <textarea id="uri-notes" placeholder="Additional notes"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">Save URI</button>
                            </form>
                        </div>
                    </div>

                    <!-- URI Search & Filter -->
                    <div class="filter-section">
                        <input type="text" id="uri-search" placeholder="Search URI...">
                        <select id="uri-status-filter">
                            <option value="">All Status</option>
                            <option value="BLOCKED">Blocked</option>
                            <option value="WHITELIST">Whitelist</option>
                            <option value="SUSPICIOUS">Suspicious</option>
                            <option value="MONITORING">Monitoring</option>
                        </select>
                    </div>

                    <!-- URI Table -->
                    <div class="table-container">
                        <table id="uri-table">
                            <thead>
                                <tr>
                                    <th>URI</th>
                                    <th>Status</th>
                                    <th>Threat Type</th>
                                    <th>Severity</th>
                                    <th>Reason</th>
                                    <th>Date Added</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="uri-tbody">
                            </tbody>
                        </table>
                    </div>

                    <div id="uri-pagination" class="pagination"></div>
                </div>

                <!-- Malicious Files Page -->
                <div id="files-page" class="page">
                    <div class="page-header">
                        <h2>Malicious File Management</h2>
                        <button id="add-file-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add File
                        </button>
                    </div>

                    <!-- File Form Modal -->
                    <div id="file-form-modal" class="modal">
                        <div class="modal-content large">
                            <span class="close">&times;</span>
                            <h3>Add/Edit Malicious File</h3>
                            <form id="file-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>File Name *</label>
                                        <input type="text" id="file-name" placeholder="malware.exe" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Hash Type *</label>
                                        <select id="file-hash-type" required>
                                            <option value="">Select Type</option>
                                            <option value="MD5">MD5</option>
                                            <option value="SHA1">SHA1</option>
                                            <option value="SHA256">SHA256</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>File Hash *</label>
                                        <input type="text" id="file-hash" placeholder="Hash value" required>
                                    </div>
                                    <div class="form-group">
                                        <label>File Type</label>
                                        <input type="text" id="file-type" placeholder="exe, dll, etc.">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Status *</label>
                                        <select id="file-status" required>
                                            <option value="">Select Status</option>
                                            <option value="DETECTED">Detected</option>
                                            <option value="QUARANTINED">Quarantined</option>
                                            <option value="BLOCKED">Blocked</option>
                                            <option value="MONITORING">Monitoring</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Malware Type</label>
                                        <select id="file-malware-type">
                                            <option value="UNKNOWN">Unknown</option>
                                            <option value="TROJAN">Trojan</option>
                                            <option value="RANSOMWARE">Ransomware</option>
                                            <option value="WORM">Worm</option>
                                            <option value="VIRUS">Virus</option>
                                            <option value="SPYWARE">Spyware</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Source Device *</label>
                                        <select id="file-source" required>
                                            <option value="">Select Source Device</option>
                                            <option value="AWS_WAF">AWS WAF</option>
                                            <option value="BARRACUDA_WAAS">Barracuda WAAS</option>
                                            <option value="TRENDMICRO">TrendMicro</option>
                                            <option value="PALOALTO_FIREWALL">Palo Alto Next-Gen Firewall</option>
                                            <option value="KASPERSKY">Kaspersky</option>
                                            <option value="CORTEX_XDR">Cortex XDR</option>
                                            <option value="FORTINET">FortiGate</option>
                                            <option value="CHECKPOINT">Check Point</option>
                                            <option value="SOPHOS">Sophos</option>
                                            <option value="SOC_ANALYST">SOC Analyst</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Severity</label>
                                        <select id="file-severity">
                                            <option value="MEDIUM">Medium</option>
                                            <option value="LOW">Low</option>
                                            <option value="HIGH">High</option>
                                            <option value="CRITICAL">Critical</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Block Location</label>
                                        <select id="file-block-location">
                                            <option value="UNKNOWN">Unknown</option>
                                            <option value="ENDPOINT">Endpoint</option>
                                            <option value="EMAIL">Email</option>
                                            <option value="WEB">Web</option>
                                            <option value="NETWORK">Network</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Detection Date & Time *</label>
                                        <input type="datetime-local" id="file-detection-time" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Associated IPs</label>
                                    <input type="text" id="file-associated-ips" placeholder="Comma-separated IPs">
                                </div>

                                <div class="form-group">
                                    <label>Associated URIs</label>
                                    <input type="text" id="file-associated-uris" placeholder="Comma-separated URIs">
                                </div>

                                <div class="form-group">
                                    <label>Action Taken By</label>
                                    <input type="text" id="file-action-by" placeholder="Your name/system">
                                </div>

                                <div class="form-group">
                                    <label>Notes</label>
                                    <textarea id="file-notes" placeholder="Additional notes"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">Save File</button>
                            </form>
                        </div>
                    </div>

                    <!-- File Search & Filter -->
                    <div class="filter-section">
                        <input type="text" id="file-search" placeholder="Search by hash or filename...">
                        <select id="file-status-filter">
                            <option value="">All Status</option>
                            <option value="DETECTED">Detected</option>
                            <option value="QUARANTINED">Quarantined</option>
                            <option value="BLOCKED">Blocked</option>
                            <option value="MONITORING">Monitoring</option>
                        </select>
                    </div>

                    <!-- File Table -->
                    <div class="table-container">
                        <table id="file-table">
                            <thead>
                                <tr>
                                    <th>File Name</th>
                                    <th>Hash (SHA256)</th>
                                    <th>Status</th>
                                    <th>Malware Type</th>
                                    <th>Severity</th>
                                    <th>Date Detected</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="file-tbody">
                            </tbody>
                        </table>
                    </div>

                    <div id="file-pagination" class="pagination"></div>
                </div>

                <!-- Action History Page -->
                <div id="history-page" class="page">
                    <div class="page-header">
                        <h2>Action History</h2>
                    </div>

                    <!-- History Filter -->
                    <div class="filter-section">
                        <select id="history-entity-filter">
                            <option value="">All Entities</option>
                            <option value="IP">IP</option>
                            <option value="URI">URI</option>
                            <option value="FILE">File</option>
                        </select>
                        <select id="history-action-filter">
                            <option value="">All Actions</option>
                            <option value="IP_BLOCKED">IP Blocked</option>
                            <option value="IP_WHITELIST">IP Whitelisted</option>
                            <option value="URI_BLOCKED">URI Blocked</option>
                            <option value="FILE_QUARANTINED">File Quarantined</option>
                        </select>
                    </div>

                    <!-- History Timeline -->
                    <div class="timeline" id="history-timeline">
                    </div>
                </div>

                <!-- Admin Console Page -->
                <div id="admin-page" class="page">
                    <div class="page-header">
                        <h2>Admin Console</h2>
                    </div>

                    <div class="admin-grid">
                        <div class="admin-card">
                            <h3><i class="fas fa-users"></i> User Management</h3>
                            <p>Manage user accounts, roles, and permissions</p>
                            <button class="btn btn-primary" id="manage-users-btn">Manage Users</button>
                        </div>
                        <div class="admin-card">
                            <h3><i class="fas fa-shield-alt"></i> Security Settings</h3>
                            <p>Configure security policies and authentication</p>
                            <button class="btn btn-primary" id="security-settings-btn">Security Settings</button>
                        </div>
                        <div class="admin-card">
                            <h3><i class="fas fa-database"></i> System Backup</h3>
                            <p>Backup and restore system data</p>
                            <button class="btn btn-primary" id="backup-btn">Backup System</button>
                        </div>
                        <div class="admin-card">
                            <h3><i class="fas fa-chart-line"></i> System Analytics</h3>
                            <p>View system performance and usage statistics</p>
                            <button class="btn btn-primary" id="analytics-btn">View Analytics</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- User Management Modal -->
    <div id="user-management-modal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h3>User Management</h3>
            <div class="user-list">
                <table>
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Email</th>
                            <th>Current Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <tr>
                            <td>John Doe</td>
                            <td>john@company.com</td>
                            <td><span class="role-indicator role-execute-only">Execute User</span></td>
                            <td>
                                <select class="role-change-select" data-user="john@company.com">
                                    <option value="read-only">Read-Only</option>
                                    <option value="write-only">Write-Only</option>
                                    <option value="execute-only" selected>Execute-Only</option>
                                    <option value="admin">Admin Access</option>
                                </select>
                                <button class="btn btn-sm btn-primary update-role-btn" data-user="john@company.com">Update</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Jane Smith</td>
                            <td>jane@company.com</td>
                            <td><span class="role-indicator role-read-only">Read-Only</span></td>
                            <td>
                                <select class="role-change-select" data-user="jane@company.com">
                                    <option value="read-only" selected>Read-Only</option>
                                    <option value="write-only">Write-Only</option>
                                    <option value="execute-only">Execute-Only</option>
                                    <option value="admin">Admin Access</option>
                                </select>
                                <button class="btn btn-sm btn-primary update-role-btn" data-user="jane@company.com">Update</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- User Profile Edit Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Edit Profile</h3>
            <form id="profile-form">
                <div class="form-group">
                    <label>Profile Picture</label>
                    <div class="avatar-upload">
                        <img src="https://via.placeholder.com/80" alt="Avatar" id="profile-avatar">
                        <input type="file" id="avatar-input" accept="image/*">
                        <button type="button" id="upload-avatar-btn">Change Photo</button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="profile-first-name" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="profile-last-name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="profile-email" required>
                </div>
                <div class="form-group">
                    <label>Organization</label>
                    <input type="text" id="profile-organization">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <input type="text" id="profile-role" readonly style="background: #f3f4f6; cursor: not-allowed;">
                    <small style="color: #6b7280;">Role can only be changed by administrators</small>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/auth-guard.js"></script>
    <script src="js/time-range.js"></script>
    <script src="js/api.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/main.js"></script>
    <style>
        .user-menu { position: relative; }
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .user-profile:hover { background-color: #f3f4f6; }
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            z-index: 1000;
            display: none;
        }
        .user-dropdown a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            text-decoration: none;
            color: #374151;
            transition: background-color 0.3s;
        }
        .user-dropdown a:hover { background-color: #f3f4f6; }
        .user-dropdown hr { margin: 0; border: none; border-top: 1px solid #e5e7eb; }
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .admin-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        .admin-card h3 { margin-bottom: 12px; color: #1f2937; }
        .admin-card p { color: #6b7280; margin-bottom: 20px; }
        .avatar-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .avatar-upload img { border-radius: 50%; width: 80px; height: 80px; }
        #avatar-input { display: none; }
        
        /* Role-based styling */
        .btn:disabled, .btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        .role-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 8px;
        }
        .role-read-only { background: #fee2e2; color: #dc2626; }
        .role-write-only { background: #fef3c7; color: #d97706; }
        .role-execute-only { background: #dbeafe; color: #2563eb; }
        .role-admin { background: #dcfce7; color: #16a34a; }
        
        /* Time Picker Styles */
        .time-picker-container { position: relative; }
        .time-picker-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            min-width: 150px;
        }
        .time-picker-btn:hover { background: #f9fafb; }
        .time-picker-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 320px;
            display: none;
        }
        .time-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }
        .time-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }
        .time-tab.active {
            background: #f3f4f6;
            border-bottom: 2px solid #2563eb;
        }
        .relative-time-content { padding: 16px; }
        .time-section {
            margin-bottom: 16px;
        }
        .time-section h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
        }
        .time-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .time-option {
            padding: 6px 12px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .time-option:hover { background: #f3f4f6; }
        .time-option.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .absolute-time-content { padding: 16px; }
        .absolute-inputs { display: flex; flex-direction: column; gap: 12px; }
        .input-group label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            font-weight: 500;
        }
    </style>
    <script>
        // Role-based access control
        let currentUserRole = 'execute-only'; // Default role, should be set from authentication
        
        // Admin login function (for testing - in production this would be handled by authentication)
        function loginAsAdmin() {
            const adminPassword = prompt('Enter admin password:');
            if (adminPassword === 'admin123') {
                currentUserRole = 'admin';
                applyRolePermissions();
                alert('Successfully logged in as Administrator!');
            } else {
                alert('Invalid admin password!');
            }
        }
        
        const rolePermissions = {
            'read-only': {
                canView: true,
                canAdd: false,
                canEdit: false,
                canDelete: false,
                canAdmin: false
            },
            'write-only': {
                canView: true,
                canAdd: true,
                canEdit: false,
                canDelete: false,
                canAdmin: false
            },
            'execute-only': {
                canView: true,
                canAdd: true,
                canEdit: true,
                canDelete: true,
                canAdmin: false
            },
            'admin': {
                canView: true,
                canAdd: true,
                canEdit: true,
                canDelete: true,
                canAdmin: true
            }
        };
        
        function applyRolePermissions() {
            const permissions = rolePermissions[currentUserRole];
            
            // Hide/show admin console completely
            const adminConsoleBtn = document.getElementById('admin-console-btn');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminNav = document.getElementById('admin-nav');
            if (permissions.canAdmin) {
                adminConsoleBtn.style.display = 'block';
                adminLoginBtn.style.display = 'none';
                adminNav.style.display = 'block';
            } else {
                adminConsoleBtn.style.display = 'none';
                adminLoginBtn.style.display = 'block';
                adminNav.style.display = 'none';
            }
            
            // Control add buttons
            const addButtons = document.querySelectorAll('#add-ip-btn, #add-uri-btn, #add-file-btn');
            addButtons.forEach(btn => {
                btn.style.display = permissions.canAdd ? 'inline-flex' : 'none';
            });
            
            // Control edit/delete actions in tables
            document.addEventListener('click', function(e) {
                if (e.target.closest('.edit-btn') && !permissions.canEdit) {
                    e.preventDefault();
                    alert('You do not have permission to edit entries.');
                }
                if (e.target.closest('.delete-btn') && !permissions.canDelete) {
                    e.preventDefault();
                    alert('You do not have permission to delete entries.');
                }
            });
            
            // Update user role display
            const roleNames = {
                'read-only': 'Read-Only User',
                'write-only': 'Write-Only User', 
                'execute-only': 'Execute User',
                'admin': 'Administrator'
            };
            const userName = document.getElementById('user-name');
            userName.innerHTML = roleNames[currentUserRole] + `<span class="role-indicator role-${currentUserRole}">${currentUserRole.replace('-', ' ')}</span>`;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const userProfile = document.getElementById('user-profile');
            const userDropdown = document.getElementById('user-dropdown');
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const adminConsoleBtn = document.getElementById('admin-console-btn');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const profileModal = document.getElementById('profile-modal');
            const uploadAvatarBtn = document.getElementById('upload-avatar-btn');
            const avatarInput = document.getElementById('avatar-input');
            
            // Apply initial role permissions
            applyRolePermissions();
            
            // Toggle user dropdown
            userProfile.addEventListener('click', function(e) {
                e.stopPropagation();
                userDropdown.style.display = userDropdown.style.display === 'block' ? 'none' : 'block';
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                userDropdown.style.display = 'none';
            });
            
            // Edit profile
            editProfileBtn.addEventListener('click', function(e) {
                e.preventDefault();
                profileModal.style.display = 'block';
                userDropdown.style.display = 'none';
                const roleNames = {
                    'read-only': 'Read-Only User',
                    'write-only': 'Write-Only User',
                    'execute-only': 'Execute User',
                    'admin': 'Administrator'
                };
                document.getElementById('profile-role').value = roleNames[currentUserRole];
            });
            
            // Admin console (only for admin users)
            adminConsoleBtn.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelector('[data-page="admin"]').click();
                userDropdown.style.display = 'none';
            });
            
            // Admin login
            adminLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                loginAsAdmin();
                userDropdown.style.display = 'none';
            });
            
            // User management
            document.getElementById('manage-users-btn').addEventListener('click', function() {
                document.getElementById('user-management-modal').style.display = 'block';
            });
            
            // Update user roles
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('update-role-btn')) {
                    const userEmail = e.target.dataset.user;
                    const newRole = document.querySelector(`select[data-user="${userEmail}"]`).value;
                    const roleSpan = e.target.closest('tr').querySelector('.role-indicator');
                    
                    const roleNames = {
                        'read-only': 'Read-Only',
                        'write-only': 'Write-Only',
                        'execute-only': 'Execute User',
                        'admin': 'Administrator'
                    };
                    
                    roleSpan.textContent = roleNames[newRole];
                    roleSpan.className = `role-indicator role-${newRole}`;
                    
                    alert(`User ${userEmail} role updated to ${roleNames[newRole]}`);
                }
            });
            
            // Time Picker Functionality
            const timePickerBtn = document.getElementById('time-picker-btn');
            const timePickerDropdown = document.getElementById('time-picker-dropdown');
            const selectedTimeSpan = document.getElementById('selected-time');
            
            timePickerBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                timePickerDropdown.style.display = timePickerDropdown.style.display === 'block' ? 'none' : 'block';
            });
            
            let currentTimeType = 'relative';
            
            // Time tab switching
            document.querySelectorAll('.time-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.time-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentTimeType = this.dataset.tab;
                    
                    if (this.dataset.tab === 'relative') {
                        document.getElementById('relative-content').style.display = 'block';
                        document.getElementById('absolute-content').style.display = 'none';
                    } else {
                        document.getElementById('relative-content').style.display = 'none';
                        document.getElementById('absolute-content').style.display = 'block';
                    }
                });
            });
            
            // Time option selection
            document.querySelectorAll('.time-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.time-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    
                    const timeLabels = {
                        '5m': 'Last 5 minutes',
                        '15m': 'Last 15 minutes',
                        '30m': 'Last 30 minutes',
                        '1h': 'Last 1 hour',
                        '3h': 'Last 3 hours',
                        '6h': 'Last 6 hours',
                        '12h': 'Last 12 hours',
                        '1d': 'Last 1 day',
                        '3d': 'Last 3 days',
                        '1w': 'Last 1 week',
                        '1M': 'Last 1 month',
                        '3M': 'Last 3 months'
                    };
                    
                    const prefix = currentTimeType === 'relative' ? 'Relative: ' : 'Absolute: ';
                    selectedTimeSpan.textContent = prefix + timeLabels[this.dataset.timeframe];
                    timePickerDropdown.style.display = 'none';
                });
            });
            
            // Absolute time apply
            document.getElementById('apply-absolute-time').addEventListener('click', function() {
                const startTime = document.getElementById('absolute-start-time').value;
                const endTime = document.getElementById('absolute-end-time').value;
                
                if (startTime && endTime) {
                    const startDate = new Date(startTime).toLocaleDateString();
                    const endDate = new Date(endTime).toLocaleDateString();
                    selectedTimeSpan.textContent = `Absolute: ${startDate} - ${endDate}`;
                    timePickerDropdown.style.display = 'none';
                } else {
                    alert('Please select both start and end dates');
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                timePickerDropdown.style.display = 'none';
            });
            
            // Profile form submission
            document.getElementById('profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                profileModal.style.display = 'none';
                alert('Profile updated successfully!');
            });
            
            // Avatar upload
            uploadAvatarBtn.addEventListener('click', function() {
                avatarInput.click();
            });
            
            avatarInput.addEventListener('change', function(e) {
                if (e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('profile-avatar').src = e.target.result;
                        document.getElementById('user-avatar').src = e.target.result;
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Close modals
            document.querySelectorAll('.modal .close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
        });
    </script>
</body>
</html>
